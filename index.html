<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CortexLuma AI</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
body { font-family:'Inter',sans-serif; background: linear-gradient(135deg,#0f172a 0%,#1e293b 100%); color:#e2e8f0; display:flex; justify-content:center; align-items:center; min-height:100vh; }
.fade-page{animation:fadePage .5s ease-in-out} @keyframes fadePage{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
.chat-box{background-color: rgba(15,23,42,0.8);backdrop-filter: blur(10px);border:1px solid rgba(99,102,241,0.15);border-radius:1rem;}
.chat-bubble{animation:fadeInUp .3s ease;} @keyframes fadeInUp{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
#chat-input:focus{box-shadow:0 0 10px rgba(99,102,241,.5);border-color:#6366f1; transition:0.2s;}
#send-button:hover{transform:scale(1.05);box-shadow:0 0 10px rgba(99,102,241,.6);} #send-button:active{transform:scale(.95);}
</style>
</head>
<body class="fade-page">
<div class="max-w-2xl w-full mx-auto p-4">
  <header class="text-center mb-4">
    <h1 class="text-3xl font-bold text-indigo-400 animate-pulse">CortexLuma AI</h1>
    <p class="text-slate-400 mt-1">Your Smart AI Buddy ðŸ¤–</p>
  </header>

  <!-- Tabs -->
  <div class="flex space-x-4 mb-4">
    <button id="tab-chat" class="bg-indigo-500 text-white px-4 py-2 rounded">Chat</button>
    <button id="tab-image" class="bg-slate-600 text-white px-4 py-2 rounded">Image</button>
  </div>

  <!-- Chat Container -->
  <div id="chat-container">
    <div id="chat-messages" class="chat-box p-4 h-[60vh] overflow-y-auto mb-4 flex flex-col space-y-4 shadow-xl">
      <div class="flex justify-start">
        <div class="bg-slate-700 p-3 rounded-xl max-w-xs md:max-w-lg text-sm shadow chat-bubble">
          Hey there ðŸ‘‹ Iâ€™m <span class="text-indigo-400 font-semibold">CortexLuma</span> â€” your AI buddy.
        </div>
      </div>
    </div>
    <form id="chat-form" class="flex flex-col space-y-2">
      <div class="relative flex items-center">
        <textarea id="chat-input" rows="1" placeholder="Send a message..." class="flex-1 p-3 pr-12 bg-slate-800 border border-slate-700 rounded-lg text-slate-200 resize-none"></textarea>
        <button type="submit" id="send-button" class="absolute right-3 bottom-2 bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded-full">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path d="M3.105 2.548A2.25 2.25 0 0 0 .5 4.675v9.5c0 1.054.912 1.908 1.996 1.908h.084l.875 1.167a.75.75 0 0 0 1.173.044l.897-.978 10.63-7.589c.866-.62.866-1.927 0-2.547L6.53 1.359a.75.75 0 0 0-1.173.044l-.897.978-.084.108Z"/>
            <path d="M10.873 9.75V7.5a.75.75 0 0 0-1.5 0v2.25H6.75a.75.75 0 0 0 0 1.5h2.623v2.25a.75.75 0 0 0 1.5 0v-2.25h2.623a.75.75 0 0 0 0-1.5h-2.623Z"/>
          </svg>
        </button>
      </div>
      <div id="error-message" class="text-red-400 text-sm h-4"></div>
    </form>
  </div>

  <!-- Image Container -->
  <div id="image-container" class="hidden">
    <textarea id="image-prompt" placeholder="Describe the image..." class="w-full p-3 rounded-lg bg-slate-800 text-white"></textarea>
    <button id="generate-image" class="mt-2 bg-indigo-600 p-2 rounded-lg text-white">Generate Image</button>
    <div id="image-results" class="flex flex-wrap gap-4 mt-4"></div>
  </div>
</div>

<script>
const chatForm = document.getElementById('chat-form');
const chatInput = document.getElementById('chat-input');
const chatMessages = document.getElementById('chat-messages');
const errorMessage = document.getElementById('error-message');
const sendButton = document.getElementById('send-button');
const BACKEND_URL = "https://studysphere-ai.onrender.com/api/chat";

let isLoading = false;

function setLoadingState(state){
  isLoading = state;
  sendButton.disabled = state;
  chatInput.disabled = state;
  errorMessage.textContent = '';
}

function addMessage(sender,text){
  const wrapper=document.createElement('div');
  wrapper.className=`flex ${sender==='user'?'justify-end':'justify-start'}`;
  const bubble=document.createElement('div');
  bubble.innerHTML=text.replace(/\n/g,'<br>');
  bubble.className=`p-3 rounded-xl max-w-xs md:max-w-lg text-sm shadow-md ${sender==='user'?'bg-slate-600 rounded-br-none text-slate-100':'bg-indigo-600 rounded-tl-none text-white'}`;
  wrapper.appendChild(bubble);
  chatMessages.appendChild(wrapper);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

function addLoadingIndicator(){
  const wrapper=document.createElement('div'); wrapper.id='loading-indicator'; wrapper.className='flex justify-start';
  const ind=document.createElement('div'); ind.className='bg-indigo-600 p-3 rounded-xl rounded-tl-none max-w-xs md:max-w-lg text-sm shadow-md'; ind.textContent='...';
  wrapper.appendChild(ind);
  chatMessages.appendChild(wrapper);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

function removeLoadingIndicator(){const ind=document.getElementById('loading-indicator'); if(ind) ind.remove();}

async function getAiResponse(prompt){
  setLoadingState(true); addLoadingIndicator();
  try{
    const res = await fetch(`${BACKEND_URL}/chat`,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({message:prompt})
    });
    removeLoadingIndicator();
    if(!res.ok){
      const err=await res.json().catch(()=>({error:'Upstream API error'}));
      throw new Error(`Error ${res.status}: ${err.error}`);
    }
    const data = await res.json();
    addMessage('ai',data.reply||'No response');
  }catch(e){console.error(e); errorMessage.innerHTML=`<span class="font-bold">Error:</span> ${e.message}`;}
  finally{setLoadingState(false); chatInput.focus();}
}

chatForm.addEventListener('submit',(e)=>{
  e.preventDefault();
  const prompt=chatInput.value.trim();
  if(prompt&&!isLoading){addMessage('user',prompt); getAiResponse(prompt); chatInput.value=''; chatInput.style.height='auto';}
});
chatInput.addEventListener('input',()=>{chatInput.style.height='auto'; chatInput.style.height=chatInput.scrollHeight+'px';});
chatInput.addEventListener('keydown',(e)=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault(); chatForm.dispatchEvent(new Event('submit'));}});

// Tabs
const tabChat=document.getElementById('tab-chat');
const tabImage=document.getElementById('tab-image');
const chatContainer=document.getElementById('chat-container');
const imageContainer=document.getElementById('image-container');
tabChat.addEventListener('click',()=>{chatContainer.classList.remove('hidden'); imageContainer.classList.add('hidden');});
tabImage.addEventListener('click',()=>{chatContainer.classList.add('hidden'); imageContainer.classList.remove('hidden');});

// Image generation
const generateBtn=document.getElementById('generate-image');
const imagePrompt=document.getElementById('image-prompt');
const imageResults=document.getElementById('image-results');

generateBtn.addEventListener('click', async()=>{
  const prompt=imagePrompt.value.trim();
  if(!prompt) return;
  const loader=document.createElement('div'); loader.textContent="Generating..."; imageResults.appendChild(loader);
  try{
    const res=await fetch(`${BACKEND_URL}/image`,{
      method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({prompt})
    });
    const data=await res.json();
    loader.remove();
    if(data.url){
      const img=document.createElement('img'); img.src=data.url; img.className="rounded-lg shadow-lg max-w-xs"; imageResults.appendChild(img);
    }else loader.textContent="Error generating image.";
  }catch(err){console.error(err); loader.textContent="Error generating image.";}
});
</script>
</body>
</html>
